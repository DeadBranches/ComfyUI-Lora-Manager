<div id="importModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <button class="close" onclick="modalManager.closeModal('importModal')">&times;</button>
            <h2>Import Recipe</h2>
        </div>
        
        <!-- Step 1: Upload Image or Input URL -->
        <div class="import-step" id="uploadStep">
            <div class="import-mode-toggle">
                <button class="toggle-btn active" data-mode="url" onclick="importManager.toggleImportMode('url')">
                    <i class="fas fa-link"></i> URL / Local Path
                </button>
                <button class="toggle-btn" data-mode="upload" onclick="importManager.toggleImportMode('upload')">
                    <i class="fas fa-upload"></i> Upload Image
                </button>
            </div>
            
            <!-- Input URL/Path Section -->
            <div class="import-section" id="urlSection">
                <p>Input a Civitai image URL or local file path to import as a recipe.</p>
                <div class="input-group">
                    <label for="imageUrlInput">Image URL or File Path:</label>
                    <div class="input-with-button">
                        <input type="text" id="imageUrlInput" placeholder="https://civitai.com/images/... or C:/path/to/image.png">
                        <button class="primary-btn" onclick="importManager.handleUrlInput()">
                            <i class="fas fa-download"></i> Fetch Image
                        </button>
                    </div>
                    <div class="error-message" id="importUrlError"></div>
                </div>
            </div>
            
            <!-- Upload Image Section -->
            <div class="import-section" id="uploadSection">
                <p>Upload an image with LoRA metadata to import as a recipe.</p>
                <div class="input-group">
                    <label for="recipeImageUpload">Select Image:</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="recipeImageUpload" accept="image/*" onchange="importManager.handleImageUpload(event)">
                        <div class="file-input-button">
                            <i class="fas fa-upload"></i> Select Image
                        </div>
                    </div>
                    <div class="error-message" id="uploadError"></div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="secondary-btn" onclick="modalManager.closeModal('importModal')">Cancel</button>
            </div>
        </div>
        
        <!-- Step 2: Recipe Details -->
        <div class="import-step" id="detailsStep" style="display: none;">
            <div class="recipe-details-layout">
                <div class="recipe-image-container">
                    <div id="recipeImagePreview" class="recipe-image"></div>
                </div>
                
                <div class="recipe-form-container">
                    <div class="input-group">
                        <label for="recipeName">Recipe Name</label>
                        <input type="text" id="recipeName" placeholder="Enter recipe name" 
                               onchange="importManager.handleRecipeNameChange(event)">
                    </div>
                    
                    <div class="input-group">
                        <label>Tags (optional)</label>
                        <div class="tag-input-container">
                            <input type="text" id="tagInput" placeholder="Add a tag">
                            <button class="secondary-btn" onclick="importManager.addTag()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                        <div id="tagsContainer" class="tags-container">
                            <div class="empty-tags">No tags added</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <label>LoRAs in this Recipe <span id="loraCountInfo" class="lora-count-info">(0/0 in library)</span></label>
                <div id="lorasList" class="loras-list">
                    <!-- LoRAs will be populated here -->
                </div>
            </div>

            <!-- Container for duplicate recipes warning -->
            <div id="duplicateRecipesContainer" class="duplicate-recipes-container" style="display: none;">
                <!-- Duplicate recipes will be populated here -->
            </div>
            
            <div class="modal-actions">
                <button class="secondary-btn" onclick="importManager.backToUpload()">Back</button>
                <button class="primary-btn" onclick="importManager.proceedFromDetails()">Next</button>
            </div>
        </div>
        
        <!-- Step 3: Download Location (if needed) -->
        <div class="import-step" id="locationStep" style="display: none;">
            <div class="location-selection">
                <!-- Path preview with inline toggle -->
                <div class="path-preview">
                    <div class="path-preview-header">
                        <label>Download Location Preview:</label>
                        <div class="inline-toggle-container" title="When enabled, files are automatically organized using configured path templates">
                            <span class="inline-toggle-label">Use Default Path</span>
                            <div class="toggle-switch">
                                <input type="checkbox" id="importUseDefaultPath">
                                <label for="importUseDefaultPath" class="toggle-slider"></label>
                            </div>
                        </div>
                    </div>
                    <div class="path-display" id="importTargetPathDisplay">
                        <span class="path-text">Select a LoRA root directory</span>
                    </div>
                </div>

                <!-- Model Root Selection -->
                <div class="input-group">
                    <label for="importLoraRoot">Select LoRA Root:</label>
                    <select id="importLoraRoot"></select>
                </div>

                <!-- Manual Path Selection -->
                <div class="manual-path-selection" id="importManualPathSelection">
                    <!-- Path input with autocomplete -->
                    <div class="input-group">
                        <label for="importFolderPath">Target Folder Path:</label>
                        <div class="path-input-container">
                            <input type="text" id="importFolderPath" placeholder="Type folder path or select from tree below..." autocomplete="off" />
                            <button type="button" id="importCreateFolderBtn" class="create-folder-btn" title="Create new folder">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="path-suggestions" id="importPathSuggestions" style="display: none;"></div>
                    </div>
                    
                    <!-- Breadcrumb navigation -->
                    <div class="breadcrumb-nav" id="importBreadcrumbNav">
                        <span class="breadcrumb-item root" data-path="">
                            <i class="fas fa-home"></i> Root
                        </span>
                    </div>
                    
                    <!-- Hierarchical folder tree -->
                    <div class="input-group">
                        <label>Browse Folders:</label>
                        <div class="folder-tree-container">
                            <div class="folder-tree" id="importFolderTree">
                                <!-- Tree will be loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="secondary-btn" onclick="importManager.backToDetails()">Back</button>
                <button class="primary-btn" onclick="importManager.saveRecipe()">Download & Save Recipe</button>
            </div>
        </div>
    </div>
</div>
